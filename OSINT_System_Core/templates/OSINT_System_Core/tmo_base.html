{% extends 'OSINT_System_Core/tso_base.html' %}
{% load static %}
{% block belly_header %}
{% endblock %}

{% block belly %}

      <style>
        #chartdiv {
          width: 100%;
          height: 400px;
        }
 
    </style>
<div class="row">
<div class="col-md-12 border border-dark">
 	<!-- HTML -->
<div id="chartdiv"></div>
</div>
</div>
<script>
    console.log("****************************************************")
    var Supported_Website_List={{ Supported_Website_List|safe }}
    console.log(Supported_Website_List)
    </script>
{% endblock %}
{% block foot_script %}
<script src="https://www.amcharts.com/lib/4/core.js"></script>
<script src="https://www.amcharts.com/lib/4/charts.js"></script>
<script src="https://www.amcharts.com/lib/4/themes/animated.js"></script>
<script>
  am4core.ready(function() {
  
    // Themes begin
    am4core.useTheme(am4themes_animated);
    // Themes end
    
    // Create chart instance
    var chart = am4core.create("chartdiv", am4charts.XYChart);
    chart.paddingLeft="40";
    // Add data
    chart.data = {{ Supported_Website_List|safe }};
    
    // Create axes
    var yAxis = chart.yAxes.push(new am4charts.CategoryAxis());
    yAxis.dataFields.category = "type";
    yAxis.renderer.grid.template.location = 0;
    yAxis.renderer.labels.template.fontSize = 10;
    yAxis.renderer.minGridDistance = 10;
    
    var xAxis = chart.xAxes.push(new am4charts.ValueAxis());
    
    // Create series
    var series = chart.series.push(new am4charts.ColumnSeries());
    series.dataFields.valueX = "target_count";
    series.dataFields.categoryY = "type";
    series.columns.template.tooltipText = "{categoryY}: [bold]{valueX}[/]";
    series.columns.template.strokeWidth = 0;
    series.columns.template.adapter.add("fill", function(fill, target) {
      if (target.dataItem) {
        switch(target.dataItem.dataContext.name) {
          case "Facebook":
            return chart.colors.getIndex(0);
            break;
          case "Instagram":
            return chart.colors.getIndex(1);
            break;
          case "Reddit":
            return chart.colors.getIndex(2);
            break;
          case "Youtube":
            return chart.colors.getIndex(3);
            break;
        }
      }
      return fill;
    });
    
    var axisBreaks = {};
    var legendData = [];
    
    // Add ranges
    function addRange(label, start, end, color) {
      var range = yAxis.axisRanges.create();
      range.category = start;
      range.endCategory = end;
      range.label.text = label;
      range.label.disabled = false;
      range.label.fill = color;
      range.label.location = 0;
      range.label.dx = -130;
      range.label.dy = 12;
      range.label.fontWeight = "bold";
      range.label.fontSize = 12;
      range.label.horizontalCenter = "left"
      range.label.inside = true;
      
      range.grid.stroke = am4core.color("#396478");
      range.grid.strokeOpacity = 1;
      range.tick.length = 200;
      range.tick.disabled = false;
      range.tick.strokeOpacity = 0.6;
      range.tick.stroke = am4core.color("#396478");
      range.tick.location = 0;
      
      range.locations.category = 1;
      var axisBreak = yAxis.axisBreaks.create();
      axisBreak.startCategory = start;
      axisBreak.endCategory = end;
      axisBreak.breakSize = 1;
      axisBreak.fillShape.disabled = true;
      axisBreak.startLine.disabled = true;
      axisBreak.endLine.disabled = true;
      axisBreaks[label] = axisBreak;  
    
      legendData.push({name:label, fill:color});
    }
    
    addRange("Facebook", "facebook_group", "facebook_profile","facebook_page", chart.colors.getIndex(0));
    addRange("Instagram", "instagram_group", "instagram_profile","instagram_page", chart.colors.getIndex(1));
    addRange("Reddit", "profiles", "subreddits", chart.colors.getIndex(2));
    addRange("Youtube", "youtube_channel", chart.colors.getIndex(3));
    
    chart.cursor = new am4charts.XYCursor();
    
    
    var legend = new am4charts.Legend();
    legend.position = "right";
    legend.scrollable = true;
    legend.valign = "top";
    legend.reverseOrder = true;
    
    chart.legend = legend;
    legend.data = legendData;
    
    legend.itemContainers.template.events.on("toggled", function(event){
      var name = event.target.dataItem.dataContext.name;
      var axisBreak = axisBreaks[name];
      if(event.target.isActive){
        axisBreak.animate({property:"breakSize", to:0}, 1000, am4core.ease.cubicOut);
        yAxis.dataItems.each(function(dataItem){
          if(dataItem.dataContext.name == name){
            dataItem.hide(1000, 500);
          }
        })
        series.dataItems.each(function(dataItem){
          if(dataItem.dataContext.name == name){
            dataItem.hide(1000, 0, 0, ["valueX"]);
          }
        })    
      }
      else{
        axisBreak.animate({property:"breakSize", to:1}, 1000, am4core.ease.cubicOut);
        yAxis.dataItems.each(function(dataItem){
          if(dataItem.dataContext.name == name){
            dataItem.show(1000);
          }
        })  
    
        series.dataItems.each(function(dataItem){
          if(dataItem.dataContext.name == name){
            dataItem.show(1000, 0, ["valueX"]);
          }
        })        
      }
    })
    
    }); // end am4core.ready()
  
  </script>
{% endblock %}
{% block base_js %}






{% endblock %}